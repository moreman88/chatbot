import os
import logging
import asyncio
import requests
import google.generativeai as genai
from openai import OpenAI
from aiogram import Bot, Dispatcher, F
from aiogram.enums import ParseMode
from aiogram.filters import CommandStart
from aiogram.types import Message, ReplyKeyboardMarkup, KeyboardButton
from aiogram.client.default import DefaultBotProperties

# ğŸ”§ --- ĞĞĞ¡Ğ¢Ğ ĞĞ™ĞšĞ˜ ---
BOT_TOKEN = "8407576281:AAF0lofeJQxBxsxEoYrMimB4ACAtVVyHN9w"
OPENAI_API_KEY = "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"
GEMINI_API_KEY = "AIzaSyBSeT4fCI0wphjsujGkfFJ9VkexhUiKveE"
OPENROUTER_KEY = "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"

COLLEGE_NAME = "ĞšĞ°Ñ€Ğ°Ğ³Ğ°Ğ½Ğ´Ğ¸Ğ½ÑĞºĞ¸Ğ¹ ĞºĞ¾Ğ»Ğ»ĞµĞ´Ğ¶ Ñ‚ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ğ¹ Ğ¸ ÑĞµÑ€Ğ²Ğ¸ÑĞ°"
SCHEDULE_URL = "https://docs.google.com/spreadsheets/d/1F82YExVeyvm0CPNuMfVYBxLPzX17p_iz/edit?usp=sharing&ouid=112502196767433801385&rtpof=true&sd=true"
SITE_URL = "https://kktis.kz"
CONTACTS_INFO = """ğŸ“ <b>ĞĞ´Ñ€ĞµÑ:</b> ĞšĞ°Ñ€Ğ°Ğ³Ğ°Ğ½Ğ´Ğ°, ÑƒĞ». Ğ—Ğ°Ñ‚Ğ°ĞµĞ²Ğ¸Ñ‡Ğ°, 75
â˜ï¸ <b>Ğ¢ĞµĞ»ĞµÑ„Ğ¾Ğ½:</b> 8-7212-37-58-44
âœ‰ï¸ <b>Email:</b> krg-koll-7092@bilim09.kzu.kz"""
# Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ±Ğ¾Ñ‚Ğ° Ğ¸ Ğ´Ğ¸ÑĞ¿ĞµÑ‚Ñ‡ĞµÑ€Ğ°
bot = Bot(token=BOT_TOKEN)
dp = Dispatcher()


def get_main_keyboard() -> ReplyKeyboardMarkup:
    """
    Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ¼ĞµĞ½Ñ Ñ ĞºĞ½Ğ¾Ğ¿ĞºĞ°Ğ¼Ğ¸
    """
    keyboard = ReplyKeyboardMarkup(
        keyboard=[
            [
                KeyboardButton(text="ğŸ“… Ğ Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ"),
                KeyboardButton(text="ğŸ“ ĞŸÑ€Ğ¸Ñ‘Ğ¼Ğ½Ğ°Ñ ĞºĞ¾Ğ¼Ğ¸ÑÑĞ¸Ñ")
            ],
            [
                KeyboardButton(text="ğŸ“ ĞšĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚Ñ‹")
            ]
        ],
        resize_keyboard=True,
        input_field_placeholder="Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ñ€Ğ°Ğ·Ğ´ĞµĞ»..."
    )
    return keyboard


# --- Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ---
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

# --- Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ±Ğ¾Ñ‚Ğ° ---
bot = Bot(
    token=BOT_TOKEN,
    default=DefaultBotProperties(parse_mode=ParseMode.HTML)
)
dp = Dispatcher()

# --- Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ OpenAI ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ° ---
client = OpenAI(api_key=OPENAI_API_KEY)

# --- Ğ¡Ğ˜Ğ¡Ğ¢Ğ•ĞœĞĞĞ¯ Ğ˜ĞĞ¡Ğ¢Ğ Ğ£ĞšĞ¦Ğ˜Ğ¯ Ğ”Ğ›Ğ¯ Ğ˜Ğ˜ ---
COLLEGE_RULES = (
    "Ğ¢Ñ‹ â€” Ğ²Ğ¸Ñ€Ñ‚ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰Ğ½Ğ¸Ğº ĞšĞ°Ñ€Ğ°Ğ³Ğ°Ğ½Ğ´Ğ¸Ğ½ÑĞºĞ¾Ğ³Ğ¾ ĞºĞ¾Ğ»Ğ»ĞµĞ´Ğ¶Ğ° Ñ‚ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ğ¹ Ğ¸ ÑĞµÑ€Ğ²Ğ¸ÑĞ° (ĞšĞšĞ¢Ğ¸Ğ¡). "
    "ĞÑ‚Ğ²ĞµÑ‡Ğ°Ğ¹ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ½Ğ° Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹, ÑĞ²ÑĞ·Ğ°Ğ½Ğ½Ñ‹Ğµ Ñ ĞºĞ¾Ğ»Ğ»ĞµĞ´Ğ¶ĞµĞ¼, Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼, Ğ¿Ñ€Ğ¸Ñ‘Ğ¼Ğ¾Ğ¼, Ñ€Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸ĞµĞ¼, "
    "ÑĞ¿ĞµÑ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚ÑĞ¼Ğ¸, ĞºĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚Ğ°Ğ¼Ğ¸ Ğ¸ ÑÑ‚ÑƒĞ´ĞµĞ½Ñ‡ĞµÑĞºĞ¾Ğ¹ Ğ¶Ğ¸Ğ·Ğ½ÑŒÑ. "
    "Ğ•ÑĞ»Ğ¸ Ğ²Ğ¾Ğ¿Ñ€Ğ¾Ñ Ğ½Ğµ ĞºĞ°ÑĞ°ĞµÑ‚ÑÑ ĞºĞ¾Ğ»Ğ»ĞµĞ´Ğ¶Ğ° Ğ¸Ğ»Ğ¸ Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ â€” Ğ²ĞµĞ¶Ğ»Ğ¸Ğ²Ğ¾ Ğ¾Ñ‚ĞºĞ°Ğ¶Ğ¸ÑÑŒ Ğ¾Ñ‚Ğ²ĞµÑ‡Ğ°Ñ‚ÑŒ, "
    "Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: Â«Ğ˜Ğ·Ğ²Ğ¸Ğ½Ğ¸Ñ‚Ğµ, Ñ Ğ¼Ğ¾Ğ³Ñƒ Ğ¾Ñ‚Ğ²ĞµÑ‡Ğ°Ñ‚ÑŒ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ½Ğ° Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹, ÑĞ²ÑĞ·Ğ°Ğ½Ğ½Ñ‹Ğµ Ñ ĞºĞ¾Ğ»Ğ»ĞµĞ´Ğ¶ĞµĞ¼ ĞšĞšĞ¢Ğ¸Ğ¡.Â» "
    "ĞÑ‚Ğ²ĞµÑ‡Ğ°Ğ¹ Ğ´Ñ€ÑƒĞ¶ĞµĞ»ÑĞ±Ğ½Ğ¾, ĞºÑ€Ğ°Ñ‚ĞºĞ¾ Ğ¸ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ğ²Ğ½Ğ¾."
)


async def generate_reply(prompt: str) -> str:
    """
    Ğ£Ğ½Ğ¸Ğ²ĞµÑ€ÑĞ°Ğ»ÑŒĞ½Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ñ‚ĞµĞºÑÑ‚Ğ°.
    ĞŸÑ‹Ñ‚Ğ°ĞµÑ‚ÑÑ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ OpenAI â†’ Gemini â†’ OpenRouter.
    ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ° Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ñ‚ĞµĞ¼Ğ°Ñ‚Ğ¸ĞºĞ¾Ğ¹ ĞšĞšĞ¢Ğ¸Ğ¡.
    """
    try:
        logger.info("ğŸ§  Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ OpenAI (GPT-4o-mini)")
        response = client.chat.completions.create(
            model="gpt-4o-mini",
            messages=[
                {"role": "system", "content": COLLEGE_RULES},
                {"role": "user", "content": prompt}
            ],
        )
        return response.choices[0].message.content.strip()

    except Exception as e:
        err = str(e)
        logger.warning(f"âš ï¸ ĞÑˆĞ¸Ğ±ĞºĞ° OpenAI: {err}")

        if "insufficient_quota" in err or "429" in err:
            # ĞŸÑ€Ğ¾Ğ±ÑƒĞµĞ¼ Gemini
            try:
                logger.info("ğŸ”„ ĞŸĞµÑ€ĞµĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğ½Ğ° Gemini...")
                genai.configure(api_key=GEMINI_API_KEY)
                model = genai.GenerativeModel("gemini-1.5-flash")
                reply = model.generate_content(f"{COLLEGE_RULES}\n\nĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ: {prompt}")
                return reply.text.strip()
            except Exception as e2:
                logger.warning(f"âš ï¸ ĞÑˆĞ¸Ğ±ĞºĞ° Gemini: {e2}")

                # ĞŸÑ€Ğ¾Ğ±ÑƒĞµĞ¼ OpenRouter
                try:
                    logger.info("ğŸ”„ ĞŸĞµÑ€ĞµĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğ½Ğ° OpenRouter...")
                    headers = {
                        "Authorization": f"Bearer {OPENROUTER_KEY}",
                        "Content-Type": "application/json",
                    }
                    data = {
                        "model": "gpt-4o-mini",
                        "messages": [
                            {"role": "system", "content": COLLEGE_RULES},
                            {"role": "user", "content": prompt}
                        ],
                    }
                    resp = requests.post(
                        "https://openrouter.ai/api/v1/chat/completions",
                        headers=headers,
                        json=data,
                        timeout=60
                    )
                    rj = resp.json()
                    return rj["choices"][0]["message"]["content"].strip()
                except Exception as e3:
                    logger.error(f"âŒ Ğ’ÑĞµ Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ñ‹ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹: {e3}")
                    return "ğŸ˜” Ğ’ÑĞµ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ ÑĞµĞ¹Ñ‡Ğ°Ñ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹. ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹ Ğ¿Ğ¾Ğ·Ğ¶Ğµ."
        else:
            return f"âš ï¸ ĞÑˆĞ¸Ğ±ĞºĞ°: {err}"

@dp.message(CommandStart())
async def cmd_start(message: Message):
    """
    ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ /start
    ĞŸÑ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ¸ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ±Ğ¾Ñ‚Ğ°
    """
    welcome_text = (
        f"â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\n"
        f"   ğŸ“ <b>{COLLEGE_NAME}</b> ğŸ“\n"
        f"â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n"
        f"ğŸ‘‹ Ğ—Ğ´Ñ€Ğ°Ğ²ÑÑ‚Ğ²ÑƒĞ¹Ñ‚Ğµ, <b>{message.from_user.first_name}</b>!\n\n"
        f"Ğ¯ â€” Ğ¾Ñ„Ğ¸Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ±Ğ¾Ñ‚ ĞºĞ¾Ğ»Ğ»ĞµĞ´Ğ¶Ğ°, Ğ¸ Ñ Ğ¿Ğ¾Ğ¼Ğ¾Ğ³Ñƒ Ğ²Ğ°Ğ¼ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾ Ğ½Ğ°Ğ¹Ñ‚Ğ¸ Ğ½ÑƒĞ¶Ğ½ÑƒÑ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ:\n\n"
        f"â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“\n"
        f"â”ƒ ğŸ“… <b>Ğ Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ</b>\n"
        f"â”ƒ    ĞĞºÑ‚ÑƒĞ°Ğ»ÑŒĞ½Ğ¾Ğµ Ñ€Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ\n"
        f"â”ƒ    Ğ·Ğ°Ğ½ÑÑ‚Ğ¸Ğ¹ Ğ²ÑĞµÑ… Ğ³Ñ€ÑƒĞ¿Ğ¿\n"
        f"â”ƒ\n"
        f"â”ƒ ğŸ“ <b>ĞšĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚Ñ‹</b>\n"
        f"â”ƒ    ĞĞ´Ñ€ĞµÑ, Ñ‚ĞµĞ»ĞµÑ„Ğ¾Ğ½Ñ‹ Ğ¸\n"
        f"â”ƒ    ÑĞ¿Ğ¾ÑĞ¾Ğ±Ñ‹ ÑĞ²ÑĞ·Ğ¸ Ñ ĞºĞ¾Ğ»Ğ»ĞµĞ´Ğ¶ĞµĞ¼\n"
        f"â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›\n\n"
        f"ğŸ‘‡ <i>Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ½ÑƒĞ¶Ğ½Ñ‹Ğ¹ Ñ€Ğ°Ğ·Ğ´ĞµĞ» Ğ² Ğ¼ĞµĞ½Ñ</i>"
    )
    
    await message.answer(
        welcome_text,
        reply_markup=get_main_keyboard(),
        parse_mode=ParseMode.HTML
    )


@dp.message(F.text == "ğŸ“… Ğ Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ")
async def show_schedule(message: Message):
    """
    ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ "Ğ Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ"
    ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ ÑÑÑ‹Ğ»ĞºÑƒ Ğ½Ğ° Ñ€Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ·Ğ°Ğ½ÑÑ‚Ğ¸Ğ¹ Ğ² Google Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°Ñ…
    """
    schedule_text = (
        f"â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\n"
        f"     ğŸ“… <b>Ğ ĞĞ¡ĞŸĞ˜Ğ¡ĞĞĞ˜Ğ• Ğ—ĞĞĞ¯Ğ¢Ğ˜Ğ™</b>\n"
        f"â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n"
        f"ğŸ“š ĞĞºÑ‚ÑƒĞ°Ğ»ÑŒĞ½Ğ¾Ğµ Ñ€Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ²ÑĞµÑ… Ğ³Ñ€ÑƒĞ¿Ğ¿ Ğ¸ Ğ¿Ñ€ĞµĞ¿Ğ¾Ğ´Ğ°Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾ Ğ² Google Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°Ñ…:\n\n"
        f"ğŸ”— <a href='{SCHEDULE_URL}'>ĞÑ‚ĞºÑ€Ñ‹Ñ‚ÑŒ Ñ€Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ</a>\n\n"
        f"â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“\n"
        f"â”ƒ â„¹ï¸ <b>ĞŸĞ¾Ğ»ĞµĞ·Ğ½Ğ°Ñ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ:</b>\n"
        f"â”ƒ\n"
        f"â”ƒ â€¢ Ğ Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ÑÑ\n"
        f"â”ƒ   Ñ€ĞµĞ³ÑƒĞ»ÑÑ€Ğ½Ğ¾\n"
        f"â”ƒ â€¢ Ğ’Ñ‹ Ğ¼Ğ¾Ğ¶ĞµÑ‚Ğµ ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ\n"
        f"â”ƒ   ÑÑÑ‹Ğ»ĞºÑƒ Ğ´Ğ»Ñ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾Ğ³Ğ¾\n"
        f"â”ƒ   Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°\n"
        f"â”ƒ â€¢ Ğ Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾\n"
        f"â”ƒ   Ğ½Ğ° Ğ»ÑĞ±Ğ¾Ğ¼ ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğµ\n"
        f"â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›\n\n"
        f"ğŸŒ ĞÑ„Ğ¸Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑĞ°Ğ¹Ñ‚: {SITE_URL}"
    )
    
    await message.answer(
        schedule_text,
        parse_mode=ParseMode.HTML,
        disable_web_page_preview=True
    )


@dp.message(F.text == "ğŸ“ ĞšĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚Ñ‹")
async def show_contacts(message: Message):
    """
    ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ "ĞšĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚Ñ‹"
    ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ ĞºĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚Ğ½ÑƒÑ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ ĞºĞ¾Ğ»Ğ»ĞµĞ´Ğ¶Ğ°
    """
    contacts_text = (
        f"â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\n"
        f"      ğŸ“ <b>ĞšĞĞĞ¢ĞĞšĞ¢ĞĞĞ¯ Ğ˜ĞĞ¤ĞĞ ĞœĞĞ¦Ğ˜Ğ¯</b>\n"
        f"â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n"
        f"â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“\n"
        f"â”ƒ ğŸ“ <b>ĞĞ´Ñ€ĞµÑ:</b>\n"
        f"â”ƒ    ĞšĞ°Ñ€Ğ°Ğ³Ğ°Ğ½Ğ´Ğ°, ÑƒĞ». Ğ—Ğ°Ñ‚Ğ°ĞµĞ²Ğ¸Ñ‡Ğ°, 75\n"
        f"â”ƒ\n"
        f"â”ƒ â˜ï¸ <b>Ğ¢ĞµĞ»ĞµÑ„Ğ¾Ğ½:</b>\n"
        f"â”ƒ    8-7212-37-58-44\n"
        f"â”ƒ\n"
        f"â”ƒ âœ‰ï¸ <b>Email:</b>\n"
        f"â”ƒ    krg-koll-7092@bilim09.kzu.kz\n"
        f"â”ƒ\n"
        f"â”ƒ ğŸŒ <b>Ğ’ĞµĞ±-ÑĞ°Ğ¹Ñ‚:</b>\n"
        f"â”ƒ    {SITE_URL}\n"
        f"â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›\n\n"
        f"â° <b>Ğ ĞµĞ¶Ğ¸Ğ¼ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹:</b>\n"
        f"ĞŸĞ¾Ğ½ĞµĞ´ĞµĞ»ÑŒĞ½Ğ¸Ğº - ĞŸÑÑ‚Ğ½Ğ¸Ñ†Ğ°: 8:00 - 17:00\n"
        f"Ğ¡ÑƒĞ±Ğ±Ğ¾Ñ‚Ğ° - Ğ’Ğ¾ÑĞºÑ€ĞµÑĞµĞ½ÑŒĞµ: Ğ’Ñ‹Ñ…Ğ¾Ğ´Ğ½Ğ¾Ğ¹\n\n"
        f"ğŸ’¬ ĞœÑ‹ Ğ²ÑĞµĞ³Ğ´Ğ° Ñ€Ğ°Ğ´Ñ‹ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¸Ñ‚ÑŒ Ğ½Ğ° Ğ²Ğ°ÑˆĞ¸ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹!"
    )

    await message.answer(
        contacts_text,
        parse_mode=ParseMode.HTML
    )


@dp.message(F.text == "ğŸ“ ĞŸÑ€Ğ¸Ñ‘Ğ¼Ğ½Ğ°Ñ ĞºĞ¾Ğ¼Ğ¸ÑÑĞ¸Ñ")
async def show_admission(message: Message):
    """
    ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ "ĞŸÑ€Ğ¸Ñ‘Ğ¼Ğ½Ğ°Ñ ĞºĞ¾Ğ¼Ğ¸ÑÑĞ¸Ñ"
    ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ¿Ğ¾ÑÑ‚ÑƒĞ¿Ğ»ĞµĞ½Ğ¸Ğ¸ Ğ¸ ÑĞ¿ĞµÑ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚ÑÑ…
    """
    # ĞŸĞµÑ€Ğ²Ğ¾Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ - ÑĞ¿ĞµÑ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸
    await message.answer(
        specialties_text := (
            f"â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\n"
            f"   ğŸ“ <b>ĞŸĞ Ğ˜ĞĞœĞĞĞ¯ ĞšĞĞœĞ˜Ğ¡Ğ¡Ğ˜Ğ¯</b>\n"
            f"â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n"
            f"<b>ĞšĞ“ĞšĞŸ Â«ĞšĞ°Ñ€Ğ°Ğ³Ğ°Ğ½Ğ´Ğ¸Ğ½ÑĞºĞ¸Ğ¹ ĞºĞ¾Ğ»Ğ»ĞµĞ´Ğ¶ Ñ‚ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ğ¸ Ğ¸ ÑĞµÑ€Ğ²Ğ¸ÑĞ°Â» Ğ¾ÑÑƒÑ‰ĞµÑÑ‚Ğ²Ğ»ÑĞµÑ‚ Ğ½Ğ°Ğ±Ğ¾Ñ€ ÑÑ‚ÑƒĞ´ĞµĞ½Ñ‚Ğ¾Ğ² Ğ½Ğ° Ğ½Ğ¾Ğ²Ñ‹Ğ¹ ÑƒÑ‡ĞµĞ±Ğ½Ñ‹Ğ¹ Ğ³Ğ¾Ğ´ Ğ¿Ğ¾ ÑĞ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğ¼ ÑĞ¿ĞµÑ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚ÑĞ¼:</b>\n\n"
            f"â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“\n"
            f"â”ƒ ğŸ’» <b>Ğ¦Ğ˜Ğ¤Ğ ĞĞ’ĞĞ¯ Ğ¢Ğ•Ğ¥ĞĞ˜ĞšĞ</b>\n"
            f"â”ƒ    (Ñ†ĞµĞ»ĞµĞ²Ğ°Ñ Ğ³Ñ€ÑƒĞ¿Ğ¿Ğ°)\n"
            f"â”ƒ    â€¢ ĞĞ° Ğ±Ğ°Ğ·Ğµ 11 ĞºĞ». - 10 Ğ¼ĞµÑÑÑ†ĞµĞ²\n"
            f"â”ƒ\n"
            f"â”ƒ âœ‚ï¸ <b>ĞŸĞĞ Ğ˜ĞšĞœĞĞ¥Ğ•Ğ Ğ¡ĞšĞĞ• Ğ˜Ğ¡ĞšĞ£Ğ¡Ğ¡Ğ¢Ğ’Ğ</b>\n"
            f"â”ƒ    â€¢ ĞĞ° Ğ±Ğ°Ğ·Ğµ 9 ĞºĞ». - 2Ğ³. 10 Ğ¼ĞµÑ.\n"
            f"â”ƒ    â€¢ ĞĞ° Ğ±Ğ°Ğ·Ğµ Ğ¢Ğ¸ĞŸĞ - 10 Ğ¼ĞµÑ.\n"
            f"â”ƒ\n"
            f"â”ƒ ğŸ‘— <b>Ğ¨Ğ’Ğ•Ğ™ĞĞĞ• ĞŸĞ ĞĞ˜Ğ—Ğ’ĞĞ”Ğ¡Ğ¢Ğ’Ğ Ğ˜</b>\n"
            f"â”ƒ    <b>ĞœĞĞ”Ğ•Ğ›Ğ˜Ğ ĞĞ’ĞĞĞ˜Ğ• ĞĞ”Ğ•Ğ–Ğ”Ğ«</b>\n"
            f"â”ƒ    â€¢ ĞĞ° Ğ±Ğ°Ğ·Ğµ 9 ĞºĞ». - 2Ğ³. 10 Ğ¼ĞµÑ.\n"
            f"â”ƒ    â€¢ ĞĞ° Ğ±Ğ°Ğ·Ğµ Ğ¢Ğ¸ĞŸĞ - 10 Ğ¼ĞµÑ.\n"
            f"â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›"
        ),
        parse_mode=ParseMode.HTML
    )

    await message.answer(
        specialties_text_2 := (
            f"â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“\n"
            f"â”ƒ ğŸ§µ <b>ĞŸĞĞ Ğ¢ĞĞĞ™</b>\n"
            f"â”ƒ    â€¢ ĞĞ° Ğ±Ğ°Ğ·Ğµ 9 ĞºĞ». - 2Ğ³. 10 Ğ¼ĞµÑ.\n"
            f"â”ƒ\n"
            f"â”ƒ ğŸ‘ <b>ĞĞ‘Ğ£Ğ’ĞĞĞ• Ğ”Ğ•Ğ›Ğ</b>\n"
            f"â”ƒ    â€¢ ĞĞ° Ğ±Ğ°Ğ·Ğµ Ğ¢Ğ¸ĞŸĞ - 10 Ğ¼ĞµÑ.\n"
            f"â”ƒ\n"
            f"â”ƒ ğŸ’¼ <b>ĞĞ¤Ğ˜Ğ¡-ĞœĞ•ĞĞ•Ğ”Ğ–Ğ•Ğ </b>\n"
            f"â”ƒ    â€¢ ĞĞ° Ğ±Ğ°Ğ·Ğµ 11 ĞºĞ». - 10 Ğ¼ĞµÑ.\n"
            f"â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›"
        ),
        parse_mode=ParseMode.HTML
    )

    await message.answer(
        documents_text := (
            f"â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\n"
            f"   ğŸ“‹ <b>Ğ”ĞĞšĞ£ĞœĞ•ĞĞ¢Ğ« Ğ”Ğ›Ğ¯ ĞŸĞĞ¡Ğ¢Ğ£ĞŸĞ›Ğ•ĞĞ˜Ğ¯</b>\n"
            f"â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n"
            f"<b>ĞĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ñ‹Ğµ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ñ‹:</b>\n\n"
            f"1ï¸âƒ£ Ğ—Ğ°ÑĞ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¾ Ğ¿Ñ€Ğ¸ĞµĞ¼Ğµ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ²\n\n"
            f"2ï¸âƒ£ ĞŸĞ¾Ğ´Ğ»Ğ¸Ğ½Ğ½Ğ¸Ğº Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ° Ğ¾Ğ± Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğ¸\n"
            f"   (Ğ°Ñ‚Ñ‚ĞµÑÑ‚Ğ°Ñ‚, Ğ´Ğ¸Ğ¿Ğ»Ğ¾Ğ¼)\n\n"
            f"3ï¸âƒ£ Ğ¤Ğ¾Ñ‚Ğ¾Ğ³Ñ€Ğ°Ñ„Ğ¸Ğ¸ 3Ã—4 ÑĞ¼ - 4 ÑˆÑ‚ÑƒĞºĞ¸\n\n"
            f"4ï¸âƒ£ ĞœĞµĞ´Ğ¸Ñ†Ğ¸Ğ½ÑĞºĞ°Ñ ÑĞ¿Ñ€Ğ°Ğ²ĞºĞ° Ñ„Ğ¾Ñ€Ğ¼Ñ‹ â„– 075Ğ£\n\n"
            f"â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“\n"
            f"â”ƒ ğŸŒ <b>Ğ”Ğ»Ñ Ğ¸Ğ½Ğ¾ÑÑ‚Ñ€Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ³Ñ€Ğ°Ğ¶Ğ´Ğ°Ğ½</b>\n"
            f"â”ƒ    <b>Ğ¸ Ğ»Ğ¸Ñ† Ğ±ĞµĞ· Ğ³Ñ€Ğ°Ğ¶Ğ´Ğ°Ğ½ÑÑ‚Ğ²Ğ°:</b>\n"
            f"â”ƒ â€¢ Ğ’Ğ¸Ğ´ Ğ½Ğ° Ğ¶Ğ¸Ñ‚ĞµĞ»ÑŒÑÑ‚Ğ²Ğ¾\n"
            f"â”ƒ â€¢ Ğ£Ğ´Ğ¾ÑÑ‚Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ¸Ğµ Ğ»Ğ¸Ñ†Ğ° Ğ±ĞµĞ· Ğ³Ñ€Ğ°Ğ¶Ğ´Ğ°Ğ½ÑÑ‚Ğ²Ğ°\n"
            f"â”ƒ â€¢ Ğ£Ğ´Ğ¾ÑÑ‚Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ¸Ğµ Ğ±ĞµĞ¶ĞµĞ½Ñ†Ğ°\n"
            f"â”ƒ â€¢ Ğ£Ğ´Ğ¾ÑÑ‚Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ¸Ğµ ĞºĞ°Ğ½Ğ´Ğ°ÑĞ°\n"
            f"â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›"
        ),
        parse_mode=ParseMode.HTML
    )

    await message.answer(
        submission_text := (
            f"â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\n"
            f"   ğŸ“¤ <b>Ğ¡ĞŸĞĞ¡ĞĞ‘Ğ« ĞŸĞĞ”ĞĞ§Ğ˜ Ğ”ĞĞšĞ£ĞœĞ•ĞĞ¢ĞĞ’</b>\n"
            f"â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n"
            f"1ï¸âƒ£ Ğ›Ğ¸Ñ‡Ğ½Ğ¾ Ğ² ĞºĞ¾Ğ»Ğ»ĞµĞ´Ğ¶Ğµ\n"
            f"   ğŸ“ Ğ³. ĞšĞ°Ñ€Ğ°Ğ³Ğ°Ğ½Ğ´Ğ°, ÑƒĞ». Ğ—Ğ°Ñ‚Ğ°ĞµĞ²Ğ¸Ñ‡Ğ°, 75\n\n"
            f"2ï¸âƒ£ Ğ§ĞµÑ€ĞµĞ· Ğ¿Ğ¾Ñ€Ñ‚Ğ°Ğ» ÑĞ»ĞµĞºÑ‚Ñ€Ğ¾Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ĞµĞ»ÑŒÑÑ‚Ğ²Ğ° ğŸŒ www.egov.kz\n\n"
            f"3ï¸âƒ£ Ğ§ĞµÑ€ĞµĞ· Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ñƒ My College\n\n"
            f"â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“\n"
            f"â”ƒ ğŸ“ <b>ĞŸĞ Ğ˜ĞĞœĞĞĞ¯ ĞšĞĞœĞ˜Ğ¡Ğ¡Ğ˜Ğ¯</b>\n"
            f"â”ƒ ğŸ‘¤ Ó˜Ğ¼Ñ–Ñ€Ñ…Ğ°Ğ½Ğ¾Ğ²Ğ° Ğœ.Ğ. â€” â˜ï¸ 8-701-842-25-36\n"
            f"â”ƒ ğŸ‘¤ Ğ˜ÑĞºĞ°ĞºĞ¾Ğ²Ğ° Ğ“.Ğš. â€” â˜ï¸ 8-700-145-45-36\n"
            f"â”ƒ â° ĞŸĞ½â€“ĞŸÑ‚: 8:00â€“17:00\n"
            f"â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›\n\n"
            f"âœ… <b>Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:</b> Ğ Ğ°ÑĞ¿Ğ¸ÑĞºĞ° Ğ¾ Ğ¿Ñ€Ğ¸ĞµĞ¼Ğµ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ²\n\n"
            f"ğŸ“š ĞœÑ‹ Ğ¶Ğ´Ñ‘Ğ¼ Ğ²Ğ°Ñ Ğ² Ğ½Ğ°ÑˆĞµĞ¼ ĞºĞ¾Ğ»Ğ»ĞµĞ´Ğ¶Ğµ!"
        ),
        parse_mode=ParseMode.HTML
    )

@dp.message(CommandStart())
async def start(message: Message):
    await message.answer(
        "ğŸ‘‹ ĞŸÑ€Ğ¸Ğ²ĞµÑ‚! Ğ¯ Ğ²Ğ¸Ñ€Ñ‚ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰Ğ½Ğ¸Ğº ĞšĞ°Ñ€Ğ°Ğ³Ğ°Ğ½Ğ´Ğ¸Ğ½ÑĞºĞ¾Ğ³Ğ¾ ĞºĞ¾Ğ»Ğ»ĞµĞ´Ğ¶Ğ° Ñ‚ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ğ¹ Ğ¸ ÑĞµÑ€Ğ²Ğ¸ÑĞ° (ĞšĞšĞ¢Ğ¸Ğ¡). "
        "Ğ—Ğ°Ğ´Ğ°Ğ¹Ñ‚Ğµ Ğ²Ğ¾Ğ¿Ñ€Ğ¾Ñ Ğ¾ Ğ¿Ğ¾ÑÑ‚ÑƒĞ¿Ğ»ĞµĞ½Ğ¸Ğ¸, Ñ€Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğ¸ Ğ¸Ğ»Ğ¸ ÑÑ‚ÑƒĞ´ĞµĞ½Ñ‡ĞµÑĞºĞ¾Ğ¹ Ğ¶Ğ¸Ğ·Ğ½Ğ¸."
    )


@dp.message()
async def chat(message: Message):
    prompt = message.text
    reply = await generate_reply(prompt)
    await message.answer(reply)


async def main():
    logger.info("âœ… Ğ‘Ğ¾Ñ‚ Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½ Ğ¸ Ğ³Ğ¾Ñ‚Ğ¾Ğ² Ğº Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğµ! Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¿Ğ¾ Ñ‚ĞµĞ¼Ğ°Ñ‚Ğ¸ĞºĞµ ĞšĞšĞ¢Ğ¸Ğ¡.")
    await dp.start_polling(bot)


if __name__ == "__main__":
    asyncio.run(main())
